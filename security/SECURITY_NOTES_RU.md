# Заметки о безопасности MTProxy

## Обзор

Этот документ описывает реализованные улучшения безопасности в MTProxy для повышения защиты от различных угроз и атак.

## Функции

### 1. Привязка сертификатов (Certificate Pinning)

Привязка сертификатов - это функция безопасности, которая защищает от атак типа "человек посередине" (MITM), гарантируя, что MTProxy принимает соединения только от серверов с конкретными, заранее одобренными сертификатами.

#### Реализация
- Использует хэши SHA256 сертификатов для сравнения
- Поддерживает до 100 привязанных сертификатов
- Проверяет сертификаты во время подключения
- Позволяет динамическое добавление/удаление привязанных сертификатов

#### Использование
Система привязки сертификатов инициализируется при запуске и автоматически проверяет все исходящие соединения с серверами на соответствие привязанным сертификатам.

### 2. Защита от DDoS-атак

Механизмы защиты от распределенных отказов в обслуживании (DDoS) для предотвращения нарушения работы сервиса от координированных атак.

#### Возможности
- Ограничение частоты запросов на IP-адрес
- Регулировка соединений
- Возможности блокировки IP-адресов
- Обнаружение шаблонов атак
- Настраиваемые пороговые значения

#### Конфигурация
- Максимальное количество соединений на IP: 100 (по умолчанию)
- Оконце ограничения частоты: 60 секунд
- Продолжительность блокировки: 300 секунд
- Блокировка IP: Включена

### 3. Интеграция с HSM (Планируется)

Интеграция с аппаратным модулем безопасности (HSM) для безопасного хранения ключей и криптографических операций.

#### Планируемые возможности
- Интерфейс PKCS#11
- Безопасная генерация ключей
- Аппаратное ускорение шифрования
- Хранение ключей с защитой от вскрытия

## Архитектура

Функции безопасности реализованы как отдельные модули, которые интегрируются с основной кодовой базой MTProxy:

```
security/
├── security-manager.c/h    # Основная координация безопасности
├── ddos-protection.c/h     # Механизмы защиты от DDoS
├── cert-pinning.c/h        # Система привязки сертификатов
├── security-enhancements.c/h # Общие улучшения безопасности
└── SECURITY_NOTES_RU.md    # Документация на русском языке
```

## Интеграция

Функции безопасности интегрированы в систему сборки с поддержкой как CMake, так и Makefile. Модули разработаны для бесшовной работы с существующим кодом MTProxy без критических изменений.

## Влияние на производительность

Функции безопасности разработаны так, чтобы минимально влиять на производительность:
- Проверка сертификатов происходит асинхронно
- Защита от DDoS использует эффективные структуры данных
- Использование памяти оптимизировано для крупномасштабных развертываний

## Уровни безопасности

Система поддерживает настраиваемые уровни безопасности:
- Уровень 0: Минимальная безопасность (для тестирования)
- Уровень 1: Стандартная безопасность (рекомендуется для большинства развертываний)
- Уровень 2: Высокий уровень безопасности (для чувствительных развертываний)
- Уровень 3: Максимальная безопасность (с возможным влиянием на производительность)